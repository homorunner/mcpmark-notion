# MCPBench MCP Service æ¶æ„åˆ†æ

## ğŸ—ï¸ æ€»ä½“æ¶æ„æ¦‚è¿°

MCPBench é¡¹ç›®é‡‡ç”¨äº†æ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œå·¥å‚æ¨¡å¼æ¥æ”¯æŒå¤šç§ MCP (Model Context Protocol) æœåŠ¡çš„é›†æˆã€‚è¯¥æ¶æ„è®¾è®¡å…·æœ‰é«˜åº¦çš„å¯æ‰©å±•æ€§å’Œæ¨¡å—åŒ–ç‰¹æ€§ã€‚

### æ¶æ„æ ¸å¿ƒåŸåˆ™

1. **æŠ½è±¡å±‚åˆ†ç¦»**: é€šè¿‡åŸºç¡€æŠ½è±¡ç±»å®šä¹‰é€šç”¨æ¥å£
2. **å·¥å‚æ¨¡å¼**: ç»Ÿä¸€çš„æœåŠ¡åˆ›å»ºå’Œç®¡ç†æœºåˆ¶  
3. **é…ç½®é©±åŠ¨**: åŸºäºç¯å¢ƒå˜é‡çš„çµæ´»é…ç½®ç³»ç»Ÿ
4. **å¼‚æ­¥æ‰§è¡Œ**: æ”¯æŒé«˜æ€§èƒ½çš„å¼‚æ­¥ä»»åŠ¡å¤„ç†

## ğŸ”§ æ ¸å¿ƒç»„ä»¶å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCPBench Architecture                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Factory       â”‚    â”‚   Config        â”‚                â”‚
â”‚  â”‚   Pattern       â”‚    â”‚   Management    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                Base Abstractions                        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚ TaskManager  â”‚ â”‚ StateManager  â”‚ â”‚ LoginHelper    â”‚ â”‚â”‚
â”‚  â”‚  â”‚   (ABC)      â”‚ â”‚    (ABC)      â”‚ â”‚    (ABC)       â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚            Service Implementations                       â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚ Notion  â”‚    â”‚ GitHub  â”‚    â”‚ PostgreSQL   â”‚        â”‚â”‚
â”‚  â”‚  â”‚Service  â”‚    â”‚Service  â”‚    â”‚  Service     â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›®å½•ç»“æ„

```
src/mcp_services/
â”œâ”€â”€ notion/              # Notion MCP æœåŠ¡å®ç° (å‚è€ƒå®ç°)
â”‚   â”œâ”€â”€ notion_task_manager.py
â”‚   â”œâ”€â”€ notion_state_manager.py
â”‚   â””â”€â”€ notion_login_helper.py
â”œâ”€â”€ github/              # GitHub MCP æœåŠ¡å®ç° (å¾…å®ç°)
â””â”€â”€ postgres/            # PostgreSQL MCP æœåŠ¡å®ç° (å¾…å®ç°)

src/base/                # åŸºç¡€æŠ½è±¡ç±»
â”œâ”€â”€ task_manager.py
â”œâ”€â”€ state_manager.py
â””â”€â”€ login_helper.py

src/factory.py           # æœåŠ¡å·¥å‚å®ç°
```

## ğŸ¯ è®¾è®¡æ¨¡å¼è¯¦è§£

### 1. å·¥å‚æ¨¡å¼ (Factory Pattern)

**ä½ç½®**: `src/factory.py`

å·¥å‚æ¨¡å¼è´Ÿè´£ç»Ÿä¸€åˆ›å»ºå’Œç®¡ç†ä¸åŒ MCP æœåŠ¡çš„ç»„ä»¶å®ä¾‹ï¼š

```python
class ServiceFactory(ABC):
    @abstractmethod
    def create_task_manager(self, config: ServiceConfig, **kwargs) -> BaseTaskManager:
        pass
    
    @abstractmethod
    def create_state_manager(self, config: ServiceConfig, **kwargs) -> BaseStateManager:
        pass
    
    @abstractmethod
    def create_login_helper(self, config: ServiceConfig, **kwargs) -> BaseLoginHelper:
        pass
```

**ä¼˜åŠ¿**:
- ç»Ÿä¸€çš„åˆ›å»ºæ¥å£
- é…ç½®é›†ä¸­ç®¡ç†
- æ˜“äºæ‰©å±•æ–°æœåŠ¡

### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

æ¯ä¸ª MCP æœåŠ¡éƒ½å®ç°ç›¸åŒçš„æŠ½è±¡æ¥å£ï¼Œä½†å…·ä½“å®ç°ç­–ç•¥ä¸åŒï¼š

- **Notion**: åŸºäº Playwright + Notion API
- **GitHub**: åŸºäº GitHub REST/GraphQL API  
- **PostgreSQL**: åŸºäº SQL è¿æ¥å’ŒæŸ¥è¯¢

### 3. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)

åŸºç¡€ç®¡ç†å™¨å®šä¹‰äº†é€šç”¨çš„æ‰§è¡Œæµç¨‹ï¼Œå…·ä½“æœåŠ¡å®ç°å„è‡ªçš„ç»†èŠ‚ã€‚

## ğŸ”Œ MCP æœåŠ¡å™¨é›†æˆæ¨¡å¼

æ¯ä¸ªæœåŠ¡éƒ½é€šè¿‡ `MCPServerStdio` æ¥é›†æˆå¯¹åº”çš„ MCP æœåŠ¡å™¨ï¼š

```python
async def _create_mcp_server(self) -> MCPServerStdio:
    return MCPServerStdio(
        params={
            "command": "npx",
            "args": ["-y", "@service/mcp-server"],
            "env": {
                # æœåŠ¡ç‰¹å®šçš„ç¯å¢ƒå˜é‡é…ç½®
            },
        },
        client_session_timeout_seconds=120,
        cache_tools_list=True,
    )
```

## ğŸ“Š é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡é…ç½®

æ‰€æœ‰æœåŠ¡é…ç½®é€šè¿‡ `.mcp_env` æ–‡ä»¶ç®¡ç†ï¼š

```bash
# Notion é…ç½®
NOTION_SOURCE_API_KEY=secret_...
NOTION_EVAL_API_KEY=secret_...

# GitHub é…ç½®  
GITHUB_TOKEN=ghp_...
GITHUB_WEBHOOK_SECRET=...

# PostgreSQL é…ç½®
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=mcpbench
POSTGRES_USER=admin
POSTGRES_PASSWORD=...
```

### é…ç½®ç±»è®¾è®¡

```python
class ServiceConfig:
    def __init__(self, service_name: str, api_key_var: Optional[str] = None, 
                 additional_vars: Optional[Dict[str, str]] = None):
        # è‡ªåŠ¨åŠ è½½ç¯å¢ƒå˜é‡
        # éªŒè¯å¿…éœ€é…ç½®
        # æä¾›é…ç½®è®¿é—®æ¥å£
```

## ğŸš€ æ‰©å±•æ–°æœåŠ¡çš„æ­¥éª¤

1. **åˆ›å»ºæœåŠ¡ç›®å½•**: `src/mcp_services/{service_name}/`
2. **å®ç°ä¸‰ä¸ªæ ¸å¿ƒç±»**:
   - `{Service}TaskManager(BaseTaskManager)`
   - `{Service}StateManager(BaseStateManager)` 
   - `{Service}LoginHelper(BaseLoginHelper)`
3. **åˆ›å»ºæœåŠ¡å·¥å‚**: `{Service}ServiceFactory(ServiceFactory)`
4. **æ³¨å†Œåˆ°å·¥å‚æ³¨å†Œè¡¨**: åœ¨ `MCPServiceFactory` ä¸­æ³¨å†Œ
5. **é…ç½®ç¯å¢ƒå˜é‡**: åœ¨ `.mcp_env` ä¸­æ·»åŠ ç›¸å…³é…ç½®

## ğŸ“ˆ æ¶æ„ä¼˜åŠ¿

- âœ… **é«˜åº¦æ¨¡å—åŒ–**: æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å®ç°
- âœ… **æ˜“äºæµ‹è¯•**: æ¸…æ™°çš„æ¥å£åˆ†ç¦»
- âœ… **é…ç½®çµæ´»**: ç¯å¢ƒå˜é‡é©±åŠ¨
- âœ… **å¼‚æ­¥æ”¯æŒ**: é«˜æ€§èƒ½ä»»åŠ¡æ‰§è¡Œ
- âœ… **é”™è¯¯éš”ç¦»**: æœåŠ¡é—´äº’ä¸å½±å“
- âœ… **æ˜“äºæ‰©å±•**: æ ‡å‡†åŒ–çš„å®ç°æ¨¡å¼ 